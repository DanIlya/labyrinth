firstly,  you should upload your subprogramm that formats map.tmx file,
secondly, you have to finally decide which container will be used for storage of the map tiles
thirdly,  you have to modify the program from the first paragraph to deal with property layer
guess that is all for now
